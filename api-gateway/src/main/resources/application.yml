spring:
  application:
    name: api-gateway

  cloud:
    gateway:
      routes:
        # ==================== AUTH SERVICE (PUBLIC) ====================
        - id: auth-service
          uri: http://localhost:9091
          predicates:
            - Path=/api/auth/**

        # ==================== USER SERVICE ====================
        - id: user-service
          uri: http://localhost:9092
          predicates:
            - Path=/api/users/**
          filters:
            - TokenRelay=

        # ==================== COMPANY SERVICE ====================
        - id: company-service
          uri: http://localhost:9093
          predicates:
            - Path=/api/company/**
          filters:
            - TokenRelay=

        # ==================== DOCUMENT SERVICE ====================
        - id: document-service
          uri: http://localhost:9094
          predicates:
            - Path=/api/documents/**
          filters:
            - TokenRelay=

        # ==================== ISSUE SERVICE ====================
        - id: issue-service
          uri: http://localhost:9095
          predicates:
            - Path=/api/issues/**
          filters:
            - TokenRelay=

        # ==================== LOCATION SERVICE ====================
        - id: location-service
          uri: http://localhost:9096
          predicates:
            - Path=/api/locations/**
          filters:
            - TokenRelay=

        # ==================== NOTIFICATION SERVICE ====================
        - id: notification-service
          uri: http://localhost:9097
          predicates:
            - Path=/api/notifications/**
          filters:
            - TokenRelay=

        # ==================== PROGRESS SERVICE ====================
        - id: progress-service
          uri: http://localhost:9098
          predicates:
            - Path=/api/progress/**
          filters:
            - TokenRelay=

        # ==================== PROJECT SERVICE ====================
        - id: project-service
          uri: http://localhost:9099
          predicates:
            - Path=/api/projects/**
          filters:
            - TokenRelay=

        # ==================== SCHEDULE SERVICE ====================
        - id: schedule-service
          uri: http://localhost:9100
          predicates:
            - Path=/api/schedules/**
          filters:
            - TokenRelay=

        # ==================== TASK SERVICE ====================
        - id: task-service
          uri: http://localhost:9101
          predicates:
            - Path=/api/tasks/**
          filters:
            - TokenRelay=

        # ==================== UNIT SERVICE ====================
        - id: unit-service
          uri: http://localhost:9102
          predicates:
            - Path=/api/units/**
          filters:
            - TokenRelay=

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:8080/realms/Strux-realm
          jwk-set-uri: http://localhost:8080/realms/Strux-realm/protocol/openid-connect/certs

server:
  port: 8081


eureka:
  client:
    enabled: false

management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
  health:
    circuitbreakers:
      enabled: true

keycloak:
  server-url: http://localhost:8080
  realm: Strux-realm
  admin-client-id: admin-cli
  admin-username: admin_new
  admin-password: admin123
  client-id: Strux-backend
  client-secret: KgHl85Qeibi8xBrxk28iRTEWoYTWZuKa

resilience4j:
  circuitbreaker:
    instances:
      auth-service:
        register-health-indicator: true
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 30000
      user-service:
        register-health-indicator: true
        sliding-window-size: 10
      company-service:
        register-health-indicator: true
        sliding-window-size: 10
      document-service:
        register-health-indicator: true
        sliding-window-size: 10
      project-service:
        register-health-indicator: true
        sliding-window-size: 10

logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: DEBUG
    org.springframework.security: DEBUG
    org.springframework.web: DEBUG
    reactor.netty: DEBUG
    com.strux.gateway: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"